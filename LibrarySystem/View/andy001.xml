<report title="Patient List by Chen, Bilkis" description="Patient list with medication count, diagnosis count and appointment count" active="1">
<query>
	select 
		de.first_name as "First Name",		
		de.last_name as "Last Name",
		sex as "Gender",
		official_lang as "Official Language",
		phone as "Phone",
		(select count(dr.drugid) from demographic de2, drugs dr where de2.demographic_no=dr.demographic_no and de2.demographic_no=de.demographic_no and dr.BN like '%{drugname}%') as "Number of medications",
		(select count(dx.dxresearch_no) from demographic de2, dxresearch dx where de2.demographic_no=dx.demographic_no and de2.demographic_no=de.demographic_no and dx.dxresearch_code in ({searchtext})) as "Number of diagnoses",
		(select count(appointment_no) from demographic de2, appointment a where de2.demographic_no=a.demographic_no and de2.demographic_no=de.demographic_no) as "Number of appointments"
	from 
		demographic de 
	order by de.first_name, de.last_name
</query>
	<param id="drugname" type="text" description="Medication keyword" />
	<param id="searchtext" type="textlist" description="ICD 9 code">  </param>
</report>